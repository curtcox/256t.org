name: CID Checks

on:
  push:
  pull_request:

jobs:
  python:
    name: Python CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-python@v5
        with:
          python-version: '3.x'
      - name: Run Python CID check
        run: python implementations/python/check.py

  javascript:
    name: JavaScript CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Run JavaScript CID check
        run: node implementations/javascript/check.js

  node:
    name: Node CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Run Node CID check
        run: node implementations/node/check.mjs

  typescript:
    name: TypeScript CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-node@v4
        with:
          node-version: '20'
      - name: Install TypeScript runner
        run: npm install --no-save --no-package-lock tsx typescript
      - name: Run TypeScript CID check
        run: npx tsx implementations/typescript/check.ts

  deno:
    name: Deno CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: denoland/setup-deno@v1
        with:
          deno-version: v1.x
      - name: Run Deno CID check
        run: deno run --allow-read implementations/deno/check.ts

  java:
    name: Java CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: '21'
      - name: Compile CID checker
        run: javac implementations/java/*.java
      - name: Run Java CID check
        run: java -cp implementations/java Check

  groovy:
    name: Groovy CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Groovy
        run: sudo apt-get update && sudo apt-get install -y groovy
      - name: Run Groovy CID check
        run: groovy -cp implementations/groovy implementations/groovy/check.groovy

  kotlin:
    name: Kotlin CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Kotlin
        run: sudo apt-get update && sudo apt-get install -y kotlin
      - name: Compile Kotlin CID checker
        run: kotlinc implementations/kotlin/Check.kt -include-runtime -d implementations/kotlin/check.jar
      - name: Run Kotlin CID check
        run: java -jar implementations/kotlin/check.jar

  scala:
    name: Scala CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Scala
        run: sudo apt-get update && sudo apt-get install -y scala
      - name: Compile Scala CID checker
        run: scalac -d implementations/scala implementations/scala/*.scala
      - name: Run Scala CID check
        run: scala -cp implementations/scala Check

  go:
    name: Go CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-go@v5
        with:
          go-version: '1.22'
      - name: Run Go CID check
        working-directory: implementations/go
        run: go run .

  dart:
    name: Dart CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: dart-lang/setup-dart@v1
        with:
          sdk: stable
      - name: Install Dart dependencies
        working-directory: implementations/dart
        run: dart pub get
      - name: Run Dart CID check
        working-directory: implementations/dart
        run: dart run check.dart

  elixir:
    name: Elixir CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: erlef/setup-beam@v1
        with:
          elixir-version: '1.18'
          otp-version: '27.0'
      - name: Run Elixir CID check
        run: elixir implementations/elixir/check.exs

  julia:
    name: Julia CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: julia-actions/setup-julia@v2
        with:
          version: '1.10'
      - name: Run Julia CID check
        run: julia implementations/julia/check.jl

  lua:
    name: Lua CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Install Lua
        run: sudo apt-get update && sudo apt-get install -y lua5.4
      - name: Run Lua CID check
        run: lua implementations/lua/check.lua

  csharp:
    name: C# CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: actions/setup-dotnet@v4
        with:
          dotnet-version: '8.0.x'
      - name: Run C# CID check
        run: dotnet run --configuration Release --project implementations/csharp -- check

  cpp:
    name: C++ CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build C++ CID checker
        run: g++ -std=c++17 implementations/cpp/check.cpp -o implementations/cpp/check -lcrypto
      - name: Run C++ CID check
        run: ./implementations/cpp/check

  rust:
    name: Rust CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: dtolnay/rust-toolchain@stable
      - name: Run Rust CID check
        working-directory: implementations/rust
        run: cargo run --release --quiet

  ruby:
    name: Ruby CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: ruby/setup-ruby@v1
        with:
          ruby-version: '3.3'
      - name: Run Ruby CID check
        run: ruby implementations/ruby/check.rb

  php:
    name: PHP CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3'
      - name: Run PHP CID check
        run: php implementations/php/check.php

  r:
    name: R CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - uses: r-lib/actions/setup-r@v2
      - name: Install R dependencies
        run: Rscript -e "install.packages(c('digest','base64enc'), repos='https://cloud.r-project.org')"
      - name: Run R CID check
        run: Rscript implementations/r/check.R

  perl:
    name: Perl CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run Perl CID check
        run: perl implementations/perl/check.pl

  powershell:
    name: PowerShell CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run PowerShell CID check
        run: pwsh implementations/powershell/check.ps1

  bash:
    name: Bash CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Run Bash CID check
        run: bash implementations/bash/check.sh

  c:
    name: C CID check
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build C CID checker
        run: gcc -std=c11 implementations/c/check.c implementations/c/cid.c -o implementations/c/check -lcrypto
      - name: Run C CID check
        run: ./implementations/c/check
